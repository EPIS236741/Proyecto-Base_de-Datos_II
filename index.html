<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco V3 Modular</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    
    <style>
        /* --- ESTILOS GENERALES --- */
        :root { --sidebar-bg: #0f172a; --bg-body: #f1f5f9; --primary: #1e293b; --accent: #10b981; --danger: #ef4444; --text-light: #64748b; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg-body); color: #1e293b; height: 100vh; overflow: hidden; }
        .hidden { display: none !important; }
        .center-screen { display: flex; justify-content: center; align-items: center; height: 100vh; }
        
        /* DASHBOARD LAYOUT */
        #view-dashboard { display: flex; height: 100%; }
        .sidebar { width: 260px; background: var(--sidebar-bg); color: white; padding: 20px; display: flex; flex-direction: column; }
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .menu-item { padding: 15px; color: #94a3b8; display: flex; gap: 10px; cursor: pointer; border-radius: 8px; margin-bottom: 5px; text-decoration: none; transition: 0.3s; }
        .menu-item.active, .menu-item:hover { background: rgba(255,255,255,0.1); color: white; }
        
        /* CARDS Y INPUTS */
        .cards-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .auth-input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; }
        .btn-primary { width: 100%; padding: 12px; background: var(--sidebar-bg); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .btn-primary:hover { opacity: 0.9; }
        
        /* TABLAS */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        td, th { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; }
        .badge-success { background: #dcfce7; color: #166534; }
        .text-green { color: var(--accent); } .text-red { color: var(--danger); }

        /* --- NUEVOS ESTILOS TRANSFERENCIAS (VISUAL MEJORADO) --- */
        .transfer-container { display: grid; grid-template-columns: 1fr 350px; gap: 30px; }
        @media (max-width: 900px) { .transfer-container { grid-template-columns: 1fr; } }

        /* Contactos Rápidos */
        .quick-contacts { display: flex; gap: 15px; margin-bottom: 25px; overflow-x: auto; padding-bottom: 10px; }
        .contact-item { text-align: center; cursor: pointer; min-width: 70px; }
        .contact-avatar { width: 60px; height: 60px; border-radius: 50%; background: #e2e8f0; display: flex; align-items: center; justify-content: center; margin: 0 auto; transition: 0.3s; border: 2px solid transparent; }
        .contact-avatar:hover { border-color: var(--accent); background: white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .contact-avatar i { font-size: 1.5rem; color: var(--sidebar-bg); }
        .contact-name { font-size: 0.8rem; margin-top: 5px; color: var(--text-light); }

        /* Input Gigante */
        .amount-wrapper { position: relative; margin: 30px 0; text-align: center; }
        .currency-symbol { font-size: 1.5rem; color: var(--text-light); vertical-align: super; }
        .big-input { width: 100%; border: none; font-size: 3.5rem; font-weight: 700; color: var(--sidebar-bg); text-align: center; background: transparent; outline: none; }
        .big-input::placeholder { color: #cbd5e1; }

        /* Resumen Lateral */
        .summary-card { background: var(--sidebar-bg); color: white; padding: 30px; border-radius: 20px; position: relative; overflow: hidden; }
        .summary-row { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 0.9rem; opacity: 0.8; }
        .summary-total { margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.2); display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold; }
        .circle-deco { position: absolute; width: 150px; height: 150px; background: rgba(255,255,255,0.05); border-radius: 50%; top: -50px; right: -50px; pointer-events: none; }
    </style>
</head>
<body>

    <div id="view-loading" class="center-screen"><h3>Cargando Banco V3...</h3></div>

    <div id="view-login" class="center-screen hidden">
        <div class="card" style="width: 400px; text-align: center;">
            <h2 style="color:var(--sidebar-bg); margin-bottom:20px;">Banco Digital</h2>
            <div id="login-error" style="color:red; display:none; margin-bottom:10px;"></div>
            <input type="email" id="login-email" class="auth-input" placeholder="Correo electrónico">
            <input type="password" id="login-password" class="auth-input" placeholder="Contraseña">
            <button class="btn-primary" style="margin-top:10px; width:100%;" onclick="handleLogin()">Iniciar Sesión</button>
            <button style="background:none; border:none; color:#666; margin-top:15px; cursor:pointer;" onclick="toggleRegistro()">Registrarse</button>
        </div>
    </div>

    <div id="view-registro-datos" class="center-screen hidden">
        <div class="card" style="width: 400px;">
            <h2 style="text-align:center; margin-bottom:15px;">Completa tu Perfil</h2>
            <input type="text" id="reg-dni" class="auth-input" placeholder="DNI">
            <input type="text" id="reg-nombres" class="auth-input" placeholder="Nombres">
            <input type="text" id="reg-apellidos" class="auth-input" placeholder="Apellidos">
            <button class="btn-primary" style="width:100%; margin-top:10px;" onclick="crearPerfilBancario()">Crear Cuenta</button>
        </div>
    </div>

    <div id="view-dashboard" class="hidden">
        <aside class="sidebar">
            <h2 style="margin-bottom: 40px; display:flex; align-items:center; gap:10px;">
                <i class='bx bxs-bank'></i> Banco V3
            </h2>
            <nav>
                <a onclick="navegarMenu('resumen')" class="menu-item active" id="nav-resumen"><i class='bx bxs-dashboard'></i> Resumen</a>
                <a onclick="navegarMenu('transferir')" class="menu-item" id="nav-transferir"><i class='bx bx-transfer'></i> Transferir</a>
                <a href="prestamos.html" class="menu-item"><i class='bx bx-money'></i> Préstamos</a>
                <a href="tarjetas.html" class="menu-item">
                    <i class='bx bx-credit-card'></i> Tarjetas
                </a>

                <a href="perfil.html" class="menu-item">
                    <i class='bx bx-user'></i> Mi Perfil
                </a>
                <a href="sucursales.html" class="menu-item">
    <i class='bx bx-map-alt'></i> Sucursales
</a>
                
                <a onclick="cerrarSesion()" class="menu-item" style="margin-top:auto; color:var(--danger)"><i class='bx bx-log-out'></i> Salir</a>
            </nav>
        </aside>

        <main class="main-content">
            <header style="margin-bottom: 30px; display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <h1 style="font-size:1.8rem;">Hola, <strong id="dash-nombre">...</strong></h1>
                    <p id="dash-email" style="color:#64748b;">...</p>
                </div>
            </header>

            <div id="panel-resumen">
                <div class="cards-container">
                    <div class="card">
                        <small style="color:var(--text-light); font-weight:bold; text-transform:uppercase;">Saldo Total (Soles)</small>
                        <h1 id="dash-saldo" style="font-size:2.5rem; margin:10px 0;">S/ 0.00</h1>
                        <small class="text-green">+0.00% este mes</small>
                    </div>
                    <div class="card">
                        <small style="color:var(--text-light); font-weight:bold; text-transform:uppercase;">Saldo Total (Dólares)</small>
                        <h1 style="font-size:2.5rem; margin:10px 0;">$ 0.00</h1>
                    </div>
                </div>

                <h3 style="margin-bottom:15px; color:var(--primary);">Movimientos Recientes</h3>
                <div class="card" style="padding:0; overflow:hidden;">
                    <table style="width:100%">
                        <thead style="background:#f8fafc;">
                            <tr><th>Fecha</th><th>Descripción</th><th>Monto</th><th>Estado</th></tr>
                        </thead>
                        <tbody id="tabla-movimientos"></tbody>
                    </table>
                </div>
            </div>

            <div id="panel-transferir" class="hidden">
                <h2 style="margin-bottom: 20px;">Realizar Transferencia</h2>

                <div class="transfer-container">
                    <div class="card">
                        <p style="font-size: 0.9em; font-weight: bold; color: var(--text-light); margin-bottom: 15px;">Frecuentes</p>
                        <div class="quick-contacts">
                            <div class="contact-item">
                                <div class="contact-avatar" style="background: var(--accent); color: white;"><i class='bx bx-plus'></i></div>
                                <div class="contact-name">Nuevo</div>
                            </div>
                            <div class="contact-item" onclick="llenarCuenta('CTA-44835141')">
                                <div class="contact-avatar"><i class='bx bxs-user'></i></div>
                                <div class="contact-name">Mamá</div>
                            </div>
                            <div class="contact-item" onclick="llenarCuenta('CTA-11223344')">
                                <div class="contact-avatar"><i class='bx bxs-briefcase'></i></div>
                                <div class="contact-name">Trabajo</div>
                            </div>
                            <div class="contact-item" onclick="llenarCuenta('CTA-55667788')">
                                <div class="contact-avatar"><i class='bx bxs-home'></i></div>
                                <div class="contact-name">Casa</div>
                            </div>
                            
                        </div>

                        <hr style="border: 0; border-top: 1px solid #f1f5f9; margin: 20px 0;">

                        <label style="font-weight: bold; font-size: 0.9em; color: var(--text-dark);">Cuenta Destino</label>
                        <div style="position: relative; margin-top: 5px;">
                            <i class='bx bx-credit-card' style="position: absolute; left: 15px; top: 13px; color: var(--text-light); font-size:1.2rem;"></i>
                            <input type="text" id="tf-destino" class="auth-input" style="padding-left: 45px;" placeholder="Ej: CTA-12345678">
                        </div>

                        <div class="amount-wrapper">
                            <span class="currency-symbol">S/</span>
                            <input type="number" id="tf-monto" class="big-input" placeholder="0.00" oninput="actualizarResumen()">
                        </div>
                        
                        <p style="text-align: center; color: var(--text-light); font-size: 0.9em;">
                            Saldo disponible: <span id="tf-saldo-disp" style="color: var(--accent); font-weight: bold;">---</span>
                        </p>
                    </div>

                    <div>
                        <div class="summary-card">
                            <div class="circle-deco"></div>
                            <h3 style="margin-bottom: 20px; font-size: 1.1rem;"><i class='bx bx-receipt'></i> Resumen</h3>
                            
                            <div class="summary-row">
                                <span>Monto a enviar</span>
                                <span id="res-monto">S/ 0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Comisión</span>
                                <span>S/ 0.00</span>
                            </div>
                            <div class="summary-total">
                                <span>Total a descontar</span>
                                <span id="res-total">S/ 0.00</span>
                            </div>

                            <button id="btn-transferir" class="btn-primary" 
                                    style="width: 100%; margin-top: 20px; background: white; color: var(--sidebar-bg);" 
                                    onclick="realizarTransferencia()">
                                Confirmar Envío <i class='bx bx-right-arrow-alt'></i>
                            </button>
                        </div>
                        
                        <div style="margin-top: 20px; background: #fff3cd; color: #856404; padding: 15px; border-radius: 8px; font-size: 0.85em; border: 1px solid #ffeeba;">
                            <i class='bx bx-info-circle'></i> Transferencias internas son inmediatas.
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script src="auth.js"></script>
    <script src="dashboard.js"></script>
    <script src="transferencias.js"></script>
    <script src="ui.js"></script>

</body>
</html>